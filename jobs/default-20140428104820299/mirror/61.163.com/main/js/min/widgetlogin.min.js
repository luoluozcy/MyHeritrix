// Elearn Login module
var widgetlogin=function(){var e=this;return{init:function(){e=this},checkLogin:function(){var e=new Date;$.get("/check/user/login/status?timestamp="+e.toString(),function(e){var t=e.status;if(t===0)$(".top-login-area").css("display","block");else if(t===1)$(".top-loggedin-area").css("display","block"),$(".label-username-welcome").text(e.username),$("#curr-username").val(e.username);else if(t===2)if(e.username){var n=window.location.href,r=window.location.href,i="http://reg.163.com/chgcookie.jsp?username="+e.username+"&product=rms&retUrl="+n+"&loginUrl="+r;window.location.href=i}else $(".top-login-area").css("display","block")})},showSelectLogin:function(){$("#btn-login").click(function(){$("#sz-login-win").css("display","block"),$("#username-input").focus()}),$("#sz-login-win").delegate(".unchecked","click",function(){$(this).removeClass("unchecked"),$(this).addClass("checked"),$("#logincheck").val("1")}),$("#sz-login-win").delegate(".checked","click",function(){$(this).removeClass("checked"),$(this).addClass("unchecked"),$("#logincheck").val("0")}),$(".sz-close-win").click(function(){$("#sz-login-win").css("display","none")})},showURSLoginWin:function(){},showSinaWeiboLogin:function(){$(".weibo-login").click(function(){WB2.login(function(t){WB2.anyWhere(function(t){e.getWbUserData(function(e){var t=e.screen_name;alert(e.id)})})})})},postURSLogin:function(){$(".login-btn-commit").click(function(){var e=$("#username-input").val(),t=$("#password-input").val();if(e==""||t=="")$(".err-message").css("display","block");else{var n=e,r=t,i,s=$("#logintype").val(),o="";$.removeCookie("szname"),$.cookie("szname",n,{expires:7}),s&&s==="parent"?url="http://61.163.com/management/parent/main":url=window.location.href;var u=$("#logincheck").val();o="https://reg.163.com/logins.jsp?type=1&savelogin="+u+"&product=rms&username="+decodeURIComponent(n)+"&password="+encodeURIComponent(r)+"&url="+url+(i?"#"+i:""),location.href=o}}),$("#password-input").keydown(function(e){if(e.keyCode==13){var t=$("#username-input").val(),n=$("#password-input").val();if(t==""||n=="")$(".err-message").css("display","block");else{var r=t,i=n,s,o=$("#logintype").val(),u="";$.removeCookie("szname"),$.cookie("szname",r,{expires:7}),o&&o==="parent"?url="http://61.163.com/management/parent/main":url=window.location.href;var a=$("#logincheck").val();u="https://reg.163.com/logins.jsp?type=1&savelogin="+a+"&product=rms&username="+decodeURIComponent(r)+"&password="+encodeURIComponent(i)+"&url="+url+(s?"#"+s:""),location.href=u}}})},logout:function(){$("#urs-logout").click(function(){var e=window.location.href,t=$("#curr-username").val(),n="http://reg.163.com/Logout.jsp?username="+t+"&url="+e;location.href=n})},getWbUserData:function(t){WB2.anyWhere(function(t){t.parseCMD("/account/get_uid.json",function(n,r){r?e.getData(t,n):alert("授权失败或错误")},{},{method:"GET"})})},getData:function(e,t){e.parseCMD("/users/show.json",function(e,t){!!t&&!!callback&&callback.call(this,e)},{uid:t.uid},{method:"GET"})}}}