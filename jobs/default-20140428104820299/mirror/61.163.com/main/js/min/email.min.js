// Elearn Email plugin
// CopyRight by NetEase
(function(e){e.fn.extend({changeTips:function(t){function i(){e(t.divTip).hide();var n=e("#username-input").val(),r=new RegExp("@","g"),i=n.match(r);!i&&n!=""&&e("#username-input").val(n+"@163.com")}function s(n){n=="up"?r==1?r=e(t.divTip).children().length-1:r--:r==e(t.divTip).children().length-1?r=1:r++,e(t.divTip).children().eq(r).addClass("active").siblings().removeClass("active")}function o(){var r=n.val(),s="",o=/@/,u=new RegExp(r.substring(r.indexOf("@")));n.val()==""?i():e(t.divTip).show().children().each(function(t){var n=e(this).attr("email");t==1&&e(this).text(r).addClass("active").siblings().removeClass("active"),t>1&&(o.test(r)?(s=r.substring(r.indexOf("@"),0),e(this).text(s+n),u.test(e(this).attr("email"))?e(this).show():t>1&&e(this).hide()):e(this).text(r+n))})}t=e.extend({divTip:""},t);var n=e(this),r=0;e(document).click(function(r){if(e(r.target).attr("class")==t.divTip||e(r.target).is("li")){var s=e(r.target).text();n.val(s),i()}else i()}),e.browser.msie?e(this).bind("propertychange input",function(){o()}):e(this).bind("input",function(){o()}),e(t.divTip).children().hover(function(){r=e(this).index(),e(this).index()!=0&&e(this).addClass("active").siblings().removeClass("active")}),n.keydown(function(o){if(o.which==38)s("up");else if(o.which==40)s();else if(o.which==13){r===0&&(r=1);var u=e(t.divTip).children().eq(r).text(),a=new RegExp("@","g"),f=u.match(a);f||(u+="@163.com"),n.val(u),i(),e("#password-input").focus()}else if(o.which==9){e(t.divTip).hide();var l=e("#username-input").val(),a=new RegExp("@","g"),f=l.match(a);!f&&l!=""&&e("#username-input").val(l+"@163.com")}})}})})(jQuery)