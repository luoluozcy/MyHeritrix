var Media={init:function(){this.showLightbox(),this.slideHandle(),this.showHandle(),this.setAudio(),this.showTopVideo(),this.videoSlideHandle(),this.addInitFlash()},showLightbox:function(){var a=$(".media_pic"),b=$(".media_video_s, .media_video");b.click(function(){var a=$(this),b=a.attr("data-index"),c=a.parent().attr("rel");return Media.showVideoBox(b,c),!1});var c=$(".collapse-button[rel]"),d=$(".collapse-button-video");c.click(function(){var a=$(this),b=0,c=a.attr("rel");return Media.showMediaBox(b,c),!1}),d.click(function(){return Media.showVideoBox(0,"video"),!1}),a.click(function(){var a=$(this),b=a.attr("rel"),c=a.parent().attr("rel");return Media.showMediaBox(b,c),!1}),$(".lightbox-close").live("click",function(){$("#popBox").remove(),$("#boxModel").remove()})},showMediaBox:function(a,b){var c=145,d=Media.getMediaData(b,"small"),e=Media.getMediaData(b,"large"),f=Media.getMediaData(b,"full"),g=Media.getMediaData(b,"author"),h=Media.setSlideData(d,b,a);if("无"==e[a])var i="";else var i='<a target="_blank" href="'+f[a]+'"><img class="img_large" src="'+e[a]+'"></a>';var j='<a target="_blank" href="'+f[a]+'" class="btn_down">下载完整图片</a>',k=Media.showHtml(700,500+c,i+h,j);$.sc2.lightBox(k,{model:!0,hasClose:!1,callback:function(){var b=$("#lightbox-content .img_large"),d=$("#lightbox-content > .imgload");d.show(),b.imgpreload(function(){var h=b.width(),i=b.height(),j=$("#light_slide").width();j>h&&(h=j),Media.setPosition($("#popBox"),h,i+c),d.hide(),$("#lightbox-content .img_large").show();var k=$("#light_slide li"),l=$("#lightbox-content > a"),m=$("#lightbox-title > .btn_down"),n=$("#light_slide .image_author strong");n.text(g[a]),$("#light_slide").imageScroll({showPic:4,imgWrapId:"imageList",btnActive:!1,prevCallback:function(){var a=$("#light_slide li.active"),c=a.attr("rel");return 0==c?!1:(c--,k.eq(c).addClass("active").siblings().removeClass("active"),b.attr("src",e[c]),l.attr("href",f[c]),m.attr("href",f[c]),void n.text(g[c]))},nextCallback:function(){var a=$("#light_slide li.active"),c=a.attr("rel");return c==e.length-1?!1:(c++,k.eq(c).addClass("active").siblings().removeClass("active"),b.attr("src",e[c]),l.attr("href",f[c]),m.attr("href",f[c]),void n.text(g[c]))}})})}})},showVideoBox:function(a,b){var c=230,d=960,e=520,f=Media.getMediaData(b,"small"),g=Media.getMediaData(b,"flv"),h=Media.getMediaData(b,"mp"),i=Media.getMediaData(b,"title"),j=Media.setVSlideData(f,b,a,i),k='<div class="lightVideo">'+Media.setVideo("http://v.163.com/swf/video/NetEaseFlvPlayerV3.swf",d,e,g[a])+"</div>";if(Common.isIOS())var l='<div class="lightVideo"><video controls="controls" width="960" height="520" poster="">                	<source src="'+h[a]+'" type="video/mp4" />        		</video></div>',k=l;var m='<p class="video_title">'+i[a]+"</p>",n=Media.showHtml(960,500+c,k+j,m);$.sc2.lightBox(n,{model:!0,hasClose:!1,callback:function(){var a=$("#lightbox-content .lightVideo"),b=$(".video_title"),d=($("#videoList .slide_video_title"),960),e=520,j=$("#light_slide").width();j>d&&(d=j),Media.setPosition($("#popBox"),d,e+c);{var k=$("#light_slide li");$("#lightbox-title > .btn_down")}$("#light_slide").imageScroll({showPic:4,imgWrapId:"videoList",btnActive:!1,prevCallback:function(){var c=$("#light_slide li.active"),f=c.attr("rel");if(0==f)return!1;if(f--,k.eq(f).addClass("active").siblings().removeClass("active"),a.html(Media.setVideo("http://v.163.com/swf/video/NetEaseFlvPlayerV3.swf",d,e,g[f])),Common.isIOS()){var j='<div class="lightVideo"><video controls="controls" width="960" height="520" poster="">				                	<source src="'+h[f]+'" type="video/mp4" />				        		</video></div>';a.html(j)}b.html(i[f])},nextCallback:function(){var c=$("#light_slide li.active"),j=c.attr("rel");if(j==f.length-1)return!1;if(j++,k.eq(j).addClass("active").siblings().removeClass("active"),a.html(Media.setVideo("http://v.163.com/swf/video/NetEaseFlvPlayerV3.swf",d,e,g[j])),Common.isIOS()){var l='<div class="lightVideo"><video controls="controls" width="960" height="520" poster="">				                	<source src="'+h[j]+'" type="video/mp4" />				        		</video></div>';a.html(l)}b.html(i[j])}})}})},showHtml:function(a,b,c,d){a="width:"+a+"px;",b="height:"+(b+21)+"px;";var e='<div id="lightbox-container" style="display:block;'+a+b+'">		<h1 id="lightbox-title">'+d+'</h1>		<div id="lightbox-content"><img src="http://hearthstone.nos.netease.com/3/common/loading.gif" class="imgload" style="display: none;">'+c+'</div>		<div class="corner corner-top-left"></div>		<div class="corner corner-top-right"></div>		<div class="corner corner-bottom-left"></div>		<div class="corner corner-bottom-right"></div>		<div class="border" id="lb-border-top" style="'+a+'"></div>		<div class="border" id="lb-border-right" style="'+b+'"></div>		<div class="border" id="lb-border-bottom" style="'+a+'"></div>		<div class="border" id="lb-border-left" style="'+b+'"></div>		<a class="ui-element lightbox-close" href="javascript:;"></a>		</div>';return e},setVideo:function(a,b,c,d){var e='<object width="'+b+'" height="'+c+'" id="FPlayer" data="'+a+'" type="application/x-shockwave-flash"><param value="transparent" name="wmode" /><param value="true" name="allowFullScreen" /><param value="always" name="allowscriptaccess" /><param value="'+a+'" allownetworking="all" name="movie" /><param value="'+d+'" name="flashvars" /></object>';return e},getMediaData:function(a,b){var c=$("div[rel="+a+"]"),b="data-"+b;return data=[],c.children("a").each(function(a,c){var d=$(c).attr(b);data.push(d)}),data},setSlideData:function(a,b,c){for(var d=[],e="",f=0;f<a.length;f++){e=c==f?" class=active":"";var g="<li"+e+" rel="+f+'><img width="120" src="'+a[f]+'"></li>';d.push(g)}var h,i=a.length,j=i-5;h=c>=j?"-"+135*j+"px":"-"+135*c+"px";var k="",l="",m="";"fanart"==b&&(k='<p class="image_author">作者：<strong></strong></p>',l="style='padding-top:5px'",m="arrow_fanart");var n='<div class="media_slide_bg"><div id="light_slide">              <a href="javascript:void(0)" class="next '+m+'"></a>              <a href="javascript:void(0)" class="prev '+m+'"></a>              <div class="imageWrap" '+l+">"+k+'<ul id="imageList" class="clearFix" rel='+b+' style="margin-left:'+h+'">'+d.join("")+"</ul></div></div></div>";return n},setVSlideData:function(a,b,c,d){for(var e=[],f="",g=0;g<a.length;g++){f=c==g?" class=active":"";var h="<li"+f+" rel="+g+'><a class="slide_video_bg" href="#"><span class="slide_video_bg_over"></span><img width="135" src="'+a[g]+'"><span class="slide_video_title">'+d[g]+"</span></a></li>";e.push(h)}var i,j=a.length,k=j-5;i=c>=k?"-"+166*k+"px":"-"+166*c+"px";var l='<div class="media_slide_v_bg"><div id="light_slide">              <a href="javascript:void(0)" class="next"></a>              <a href="javascript:void(0)" class="prev"></a>              <div class="imageWrap">                    <ul id="videoList" class="clearFix" rel='+b+' style="margin-left:'+i+'">'+e.join("")+"</ul></div></div></div>";return l},slideHandle:function(){var a=$("#imageList li");a.live("click",function(){var a=$("#lightbox-content .img_large"),b=$("#lightbox-title a"),c=$("#lightbox-content > a"),d=$("#lightbox-content .imgload"),e=$("#light_slide .image_author strong"),f=$(this),g=f.attr("rel"),h=f.parent().attr("rel"),i=Media.getMediaData(h,"large"),j=Media.getMediaData(h,"full"),k=Media.getMediaData(h,"author");f.addClass("active").siblings().removeClass("active"),d.show(),a.hide(),a.attr("src",i[g]),a.imgpreload(function(){var b=a.width(),c=a.height(),e=$("#light_slide").width();e>b&&(b=e),Media.setPosition($("#popBox"),b,c+145),d.hide(),a.show()}),b.attr("href",j[g]),c.attr("href",j[g]),e.text(k[g])})},videoSlideHandle:function(){var a=$("#videoList li");a.live("click",function(){var a=($("#lightbox-content .lightVideo"),$("#lightbox-title p")),b=$(this),c=b.attr("rel"),d="video",e=(Media.getMediaData(d,"small"),Media.getMediaData(d,"flv")),f=Media.getMediaData(d,"mp"),g=Media.getMediaData(d,"title"),h=960,i=520,j=Media.setVideo("http://v.163.com/swf/video/NetEaseFlvPlayerV3.swf",h,i,e[c]);if(Common.isIOS())var k='<div class="lightVideo"><video controls="controls" width="960" height="520" poster="">                	<source src="'+f[c]+'" type="video/mp4" />        		</video></div>',j=k;return b.addClass("active").siblings().removeClass("active"),$(".lightVideo").html(j),a.text(g[c]),!1})},setPosition:function(a,b,c){var d=$("#lightbox-container"),e=$("#lb-border-top",d),f=$("#lb-border-right",d),g=$("#lb-border-bottom",d),h=$("#lb-border-left",d);d.width(b).height(c),e.width(b),f.height(c),g.width(b),h.height(c);var i=$(window).width(),j=$(window).height(),k=$(window).scrollTop(),l=a.width(),m=a.height(),n=(i-l)/2,o=(j-m)/2+k;a.animate({left:n+"px",top:o+"px"},300)},showHandle:function(){var a=($(".media_video_w"),$(".media_wallpaper"));a.slice(0,2).show();var b=$(".collapse-button-more");b.click(function(){var a=$(this),b=a.parent().next();return a.toggleClass("collapse-button-show"),b.children().slice(2).stop().slideToggle(),!1})},setAudio:function(){soundManager.setup({url:"/images/media/",preferFlash:!1,onready:function(){},ontimeout:function(){}});var a=$(".media_audio .btn_audio"),b=null;a.click(function(){var a=$(this),c=a.attr("href");if(a.toggleClass("btn_audio_play").parent().siblings().find(".btn_audio").removeClass("btn_audio_play"),null!=b){if(!a.hasClass("btn_audio_play"))return b.stop(),b=null,!1;b.stop()}return b=soundManager.createSound({url:c}),b.play(),!1})},showTopVideo:function(){var a=$("#mediaTop .top_video");a.live("click",function(){var a=$(this),b=a.data("flv"),c=a.data("mp4"),d=Common.videoWrap("http://v.163.com/swf/video/NetEaseFlvPlayerV3.swf",960,520,b),e=Common.getBoxwrap();e[3]=d,Common.isIOS()&&(e[3]=Common.showIosVideo(c)),$.sc2.lightBox(e.join(""),{model:!0,hasClose:!1})})},addInitFlash:function(){Common.addFlash("http://hearthstone.nos.netease.com/3/flash/media/video1.swf","video_a_flash",397,227),Common.addFlash("http://hearthstone.nos.netease.com/3/flash/media/video2.swf","video_b_flash",397,227)}};