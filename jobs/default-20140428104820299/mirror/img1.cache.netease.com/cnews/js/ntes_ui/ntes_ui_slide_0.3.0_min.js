(function(e,t){var s=e.NTES||{};if(!s.ui){s.ui={}}var o={forward:function(e){var t=this,s=Math.abs(t._bPos)-e;t._setPos(s);s==0&&t.stop()},backward:function(e){var t=this,s=t._bPos+e;s=s<t._bRange?s:t._bRange;t._setPos(s);s==t._bRange&&t.stop()}};s.ui.ScrollCarousel=function(e,o,n,i){if(!arguments.length){return}var r=this;r.constructor=arguments.callee;r._axis=o=="y"?"y":"x";r._fix=r._axis=="x"?{pos:"left",offsetSize:"offsetWidth",pageAxis:"pageX",offsetPos:"left",scrollPos:"scrollLeft"}:{pos:"top",offsetSize:"offsetHeight",pageAxis:"pageY",offsetPos:"offsetTop",scrollPos:"scrollTop"};r.fps=i&&Math.ceil(i.fps/50)||13;r.fps=r.fps<13?13:r.fps;r.lpf=10;r.speed=40;if(s.browser.msie){r.speed=20}r._body=e;r._bCnt=e.parentNode;r._bRange=Math.max(0,r._body[r._fix.offsetSize]-r._bCnt[r._fix.offsetSize]);r._bPos=r._body.offsetLeft;s(r._bCnt).addCss("overflow:hidden");if(n!==t){r._handle=n;r._hCnt=n.parentNode;r._hPos=0;r._hRange=Math.max(0,r._hCnt[r._fix.offsetSize]-r._handle[r._fix.offsetSize]);r.bhRate=r._hRange?r._bRange/r._hRange:0;var a=new s.ui.Mouse(r._handle);a.mouseStart=r._mouseStart.bind(r);a.mouseDrag=r._mouseDrag.bind(r);a.mouseStop=r._mouseStop.bind(r);s(r._hCnt).addEvent("click",r._mouseClick.bind(r))}};s.ui.ScrollCarousel.prototype={start:function(e,s){var n=this;if(n._timer==t){e=e=="forward"?"forward":"backward";n._move=o[e];var i={length:isNaN(s)?-1:parseInt(s)};n._timer=setInterval(n._scroll.bind(n,i),n.fps);n.onStart&&n.onStart()}},stop:function(){var e=this;if(e._timer!==t){clearTimeout(e._timer);e._timer=t;e.onStop&&e.onStop()}return this},scrollTo:function(e){var t=this,s=e;s<0?t.stop().start("forward",-1*s):t.stop().start("backward",s)},_scroll:function(e){var t=this,s=t.lpf;if(e.length!==0){if(e.length>0){s=Math.min(t.lpf*Math.ceil(e.length/t.speed),e.length);e.length-=s}t._move(s)}else{t.stop()}},_setPos:function(e){var t=this;t._bPos=e;t._body.style.left=-t._bPos+"px";if(t._handle){t._hPos=t.bhRate?e/t.bhRate:0;t._handle.addCss(t._fix.pos+":"+t._hPos+"px")}},_mouseStart:function(e){var t=this;t._diffPos=e[t._fix.pageAxis]-t._handle[t._fix.offsetPos];return true},_mouseDrag:function(e){var t=this,s=Math.max(0,Math.min(e[t._fix.pageAxis]-t._diffPos,t._hRange));t._setPos(s*t.bhRate);return false},_mouseStop:function(e){return false},_mouseClick:function(e){var t=this,s=t._hCnt,o=s[t._fix.offsetPos];while(s.offsetParent){s=s.offsetParent;o+=s[t._fix.offsetPos]}t.scrollTo((e[t._fix.pageAxis]-t._handle[t._fix.offsetSize]/2-o)*t.bhRate)}};s.ui.Carousel=function(e,t,o,n){var i=this;i.ctrls=e,i.cons=t,i.css=o,i.defaults={auto:false,interval:2e3,duration:5e3,pause:"mouseover",goOn:"mouseout",event:"mouseover"},i.options=s.util.extend(i.defaults,n),i.event=i.options.event||i.defaults.event,i.btn={},i.scrol=[],i.step,i.btn.prev=i.options.prev,i.btn.next=i.options.next,i.current;if(arguments.length<3){return}if(i.cons.length!=i.ctrls.length){throw"can not match ctrls("+i.ctrls.length+") and contents("+i.cons.length+")"}i.wrap=i.cons[0].parentNode,i.activeMap={prev:function(e){var t=e.previousSibling;for(;t;t=t.previousSibling){if(t.nodeType===1&&t!==e){return t}}},next:function(e){var t=e.nextSibling;for(;t;t=t.nextSibling){if(t.nodeType===1&&t!==e){return t}}}};i.consMap={first:function(e){return e[0]},last:function(e){return e[e.length-1]}};i.stepMap={x:function(e){return e.offsetWidth},y:function(e){return e.offsetHeight}};i.step=i.stepMap.x(i.cons[0]);if(!i.current){i.cons.each(function(e){if(this.className.indexOf(i.css)>-1){i.current=e}})}if(i.options.auto){try{s(i.wrap).addEvent(i.options.goOn,i.cycle.bind(i));s(i.wrap).addEvent(i.options.pause,i.pause.bind(i))}catch(r){}}s(i.ctrls[i.current]).addCss(i.css);i.ctrls.each(function(e){s(i.ctrls[e]).addEvent(i.event,function(){i.to(e)})});if(i.btn.prev){if(i.event!="click"){i.btn.prev.addEvent("click",function(e){i.prev();return false})}i.btn.prev.addEvent(i.event,i.prev.bind(i))}if(i.btn.next){if(i.event!="click"){i.btn.next.addEvent("click",function(e){i.next();return false})}i.btn.next.addEvent(i.event,i.next.bind(i))}i.total=i.cons.length;i.cycle()};s.ui.Carousel.prototype={getStyle:function(e,t){var s="";if(document.defaultView&&document.defaultView.getComputedStyle){s=document.defaultView.getComputedStyle(e,"").getPropertyValue(t)}else{if(e.currentStyle){t=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()});s=e.currentStyle[t]}}return s},cycle:function(e){var t=this;t.paused=false;if(t.options.auto){t.interval=setInterval(function(){t.next()},t.options.interval)}return this},to:function(e){var t=this,s=t.cons[t.current]||t.cons[0];if(e>t.cons.length-1||e<0){return}if(t.current==e){return t.pause().cycle()}return t.slide(e>t.current?"next":"prev",t.cons[e])},pause:function(e){var t=this;t.paused=true;clearInterval(t.interval);t.interval=null;return t},next:function(e){var t=this;e&&e.preventDefault();if(t.sliding){return}return t.slide("next")},prev:function(e){var t=this;e&&e.preventDefault();if(t.sliding){return false}return t.slide("prev")},slide:function(e,o){var n=this,i,r,a,l=n.interval,f=e=="next"?"left":"right",p=e=="next"?"first":"last";i=n.cons[n.current]||n.cons[0];a=o||n.activeMap[e](i);a=a||n.consMap[p](n.cons);this.sliding=true;l&&n.pause();if(a.className.indexOf(n.css)>-1){return}if(n.step==0||n.step==null){n.step=n.stepMap.x(i);if(n.step==0||n.step==null){n.step=310;throw"carsousel slide get a wrong step"}}if(f=="left"){s(i.parentNode).addCss("position:relative;width:"+n.step*2+"px;overflow:hidden;zoom:1;position:relative;left:0px;height:"+n.stepMap.y(i)+"px;");s(i.parentNode.parentNode).addCss("position:relative;overflow:hidden;zoom:1;width:"+n.step+"px;");s(a).addCss("position:absolute;top:0px;left:"+n.step+"px;zoom:1;display:block");s(i).addCss("position:absolute;top:0px;left:0;display:block;zoom:1;")}else{s(i.parentNode).addCss("position:relative;width:"+n.step*2+"px;overflow:hidden;zoom:1;position:relative;left:-"+n.step+"px;height:"+n.stepMap.y(i)+"px;");s(i.parentNode.parentNode).addCss("position:relative;overflow:hidden;zoom:1;width:"+n.step+"px;");s(a).addCss("position:absolute;top:0px;left:0px;zoom:1;display:block");s(i).addCss("position:absolute;top:0px;left:"+n.step+"px;display:block;zoom:1;")}n.s=new NTES.ui.ScrollCarousel(i.parentNode,"x",t,{fps:n.options.duration});n.cons.each(function(e){if(n.cons[e]==a){n.nextIndex=e}});s(n.ctrls[n.current]).removeCss(n.css);s(n.ctrls[n.nextIndex]).addCss(n.css);n.s.onStart=function(){n.sliding=true};n.s.onStop=function(){if(f=="left"){i.removeCss(n.css);i.removeCss("position:absolute;top:0px;left:0;display:block;");s(a).removeCss("left:"+n.step+"px;");s(i.parentNode).removeCss("width:"+n.step*2+"px;left:-"+n.step+"px;");a.addCss(n.css);n.sliding=false}else{i.removeCss(n.css);a.addCss(n.css);s(a.parentNode).removeCss("position:relative;width:"+n.step*2+"px;overflow:hidden;left:0px;");s(a).removeCss("position:absolute;top:0px;left:0px;zoom:1;display:block");s(i).removeCss("position:absolute;top:0px;left:"+n.step+"px;display:block;zoom:1;");n.sliding=false}};n.current=n.nextIndex;l&&n.cycle();switch(f){case"left":n.s.scrollTo(n.step);break;case"right":n.s.scrollTo(-n.step);break}return n}}})(window);